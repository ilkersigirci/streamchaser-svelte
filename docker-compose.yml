version: '3'
services:
    frontend:
        restart: on-failure
        build: ./frontend
        container_name: svelte
        command: npm run dev -- --host
        ports:
            - 3000:3000
            - 24678:24678
        volumes:
            - ./frontend:/app
            - /app/node_modules
    backend:
        build: ./backend
        container_name: fastapi
        ports:
            - 1337:1337
        volumes:
            - ./backend/:/app/backend
        depends_on:
            - db
            - search
        links:
            - db
    search:
        image: getmeili/meilisearch:v0.21.0
        container_name: meilisearch
        ports:
            - 7700:7700
    db:
        image: postgres
        container_name: postgres
        environment:
            POSTGRES_PASSWORD: postgres
            POSTGRES_USER: postgres
            POSTGRES_DB: streamchaser
        volumes:
            - pgdata:/var/lib/postgresql/data
        ports:
            - 5432:5432
        restart: always
volumes:
    pgdata:
    node_modules:
